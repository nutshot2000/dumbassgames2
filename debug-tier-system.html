<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DumbassGames - Tier System Debug</title>
    <style>
        body {
            background: #0a0a0a;
            color: #00ff00;
            font-family: monospace;
            padding: 20px;
            margin: 0;
        }
        .debug-section {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .debug-button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .debug-button:hover {
            background: #00ffff;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #00ffff;
        }
        .warning {
            color: #ffff00;
        }
        pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîß TIER SYSTEM DEBUG CONSOLE</h1>
    
    <div class="debug-section">
        <h3>üîç Current User Status</h3>
        <button class="debug-button" onclick="checkCurrentUser()">Check User Profile</button>
        <button class="debug-button" onclick="checkUserTier()">Check User Tier</button>
        <button class="debug-button" onclick="checkSubmissionLimits()">Check Submission Limits</button>
        <pre id="userStatus">Click a button to check user status...</pre>
    </div>

    <div class="debug-section">
        <h3>üéÆ Submission Testing</h3>
        <button class="debug-button" onclick="testSubmissionLimit()">Test Submission Limit Modal</button>
        <button class="debug-button" onclick="testFakeSubmission()">Test Fake Submission</button>
        <button class="debug-button" onclick="resetSubmissionCount()">Reset Monthly Count</button>
        <pre id="submissionStatus">Ready to test submissions...</pre>
    </div>

    <div class="debug-section">
        <h3>‚≠ê Tier Upgrade Testing</h3>
        <button class="debug-button" onclick="showUpgradeModal()">Show Upgrade Modal</button>
        <button class="debug-button" onclick="testUpgradeToPro()">Test Upgrade to PRO</button>
        <button class="debug-button" onclick="testUpgradeToDev()">Test Upgrade to DEV</button>
        <pre id="upgradeStatus">Ready to test upgrades...</pre>
    </div>

    <div class="debug-section">
        <h3>üîß System Status</h3>
        <button class="debug-button" onclick="checkFirebaseConnection()">Check Firebase Connection</button>
        <button class="debug-button" onclick="checkTierManager()">Check TierManager</button>
        <button class="debug-button" onclick="checkUserProfileManager()">Check UserProfileManager</button>
        <pre id="systemStatus">Ready to check system status...</pre>
    </div>

    <div class="debug-section">
        <h3>üßπ Reset Functions</h3>
        <button class="debug-button" onclick="resetToFree()">Reset User to FREE</button>
        <button class="debug-button" onclick="clearAllData()">Clear All Local Data</button>
        <button class="debug-button" onclick="refreshProfile()">Force Refresh Profile</button>
        <pre id="resetStatus">Reset functions ready...</pre>
    </div>

    <!-- Load the main script -->
    <script src="script.js"></script>
    
    <script>
        let debugOutput = {};

        function log(section, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            
            if (!debugOutput[section]) debugOutput[section] = [];
            debugOutput[section].push(`${prefix} [${timestamp}] ${message}`);
            
            const element = document.getElementById(section);
            if (element) {
                element.innerHTML = debugOutput[section].slice(-10).join('\n');
                element.className = className;
            }
        }

        // User Status Functions
        async function checkCurrentUser() {
            try {
                log('userStatus', 'Checking current user...');
                
                if (!window.userProfileManager) {
                    log('userStatus', 'UserProfileManager not found!', 'error');
                    return;
                }

                const profile = window.userProfileManager.userProfile;
                if (!profile) {
                    log('userStatus', 'No user profile - user not signed in', 'warning');
                    return;
                }

                log('userStatus', `User: ${profile.email}`, 'success');
                log('userStatus', `Tier: ${profile.tier || 'FREE'}`, 'info');
                log('userStatus', `Submissions: ${JSON.stringify(profile.submissionCount || {})}`, 'info');
                log('userStatus', `Last Submission: ${profile.lastSubmission || 'None'}`, 'info');
            } catch (error) {
                log('userStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function checkUserTier() {
            try {
                log('userStatus', 'Checking user tier details...');
                
                const tierManager = window.userProfileManager?.tierManager;
                if (!tierManager) {
                    log('userStatus', 'TierManager not found!', 'error');
                    return;
                }

                const profile = window.userProfileManager.userProfile;
                const tierName = profile?.tier || 'FREE';
                const tierInfo = tierManager.getTierInfo(tierName);
                
                log('userStatus', `Tier Info: ${JSON.stringify(tierInfo, null, 2)}`, 'success');
            } catch (error) {
                log('userStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function checkSubmissionLimits() {
            try {
                log('userStatus', 'Checking submission limits...');
                
                const tierManager = window.userProfileManager?.tierManager;
                const profile = window.userProfileManager?.userProfile;
                
                if (!tierManager || !profile) {
                    log('userStatus', 'TierManager or profile not found!', 'error');
                    return;
                }

                const limitCheck = await tierManager.checkSubmissionLimits(profile);
                log('userStatus', `Limit Check: ${JSON.stringify(limitCheck, null, 2)}`, 'success');
                
                const canSubmit = await tierManager.canSubmitGame(profile);
                log('userStatus', `Can Submit: ${JSON.stringify(canSubmit, null, 2)}`, 'success');
            } catch (error) {
                log('userStatus', `Error: ${error.message}`, 'error');
            }
        }

        // Submission Testing Functions
        async function testSubmissionLimit() {
            try {
                log('submissionStatus', 'Testing submission limit modal...');
                
                if (window.testSubmissionLimit) {
                    window.testSubmissionLimit();
                    log('submissionStatus', 'Submission limit modal should be showing', 'success');
                } else {
                    log('submissionStatus', 'testSubmissionLimit function not found!', 'error');
                }
            } catch (error) {
                log('submissionStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function testFakeSubmission() {
            try {
                log('submissionStatus', 'Testing fake submission...');
                
                const profile = window.userProfileManager?.userProfile;
                if (!profile) {
                    log('submissionStatus', 'User not signed in!', 'error');
                    return;
                }

                // Increment submission count
                if (!profile.submissionCount) {
                    profile.submissionCount = { daily: 0, weekly: 0, monthly: 0 };
                }
                profile.submissionCount.monthly++;
                profile.lastSubmission = new Date().toISOString();

                // Save to Firebase
                if (window.userProfileManager.saveUserProfile) {
                    await window.userProfileManager.saveUserProfile(profile);
                    log('submissionStatus', `Fake submission added. Monthly count: ${profile.submissionCount.monthly}`, 'success');
                } else {
                    log('submissionStatus', 'saveUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('submissionStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function resetSubmissionCount() {
            try {
                log('submissionStatus', 'Resetting submission count...');
                
                const profile = window.userProfileManager?.userProfile;
                if (!profile) {
                    log('submissionStatus', 'User not signed in!', 'error');
                    return;
                }

                profile.submissionCount = { daily: 0, weekly: 0, monthly: 0 };
                
                if (window.userProfileManager.saveUserProfile) {
                    await window.userProfileManager.saveUserProfile(profile);
                    log('submissionStatus', 'Submission count reset to 0', 'success');
                } else {
                    log('submissionStatus', 'saveUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('submissionStatus', `Error: ${error.message}`, 'error');
            }
        }

        // Upgrade Testing Functions
        async function testUpgradeToPro() {
            try {
                log('upgradeStatus', 'Testing upgrade to PRO...');
                
                const profile = window.userProfileManager?.userProfile;
                if (!profile) {
                    log('upgradeStatus', 'User not signed in!', 'error');
                    return;
                }

                profile.tier = 'PRO';
                profile.upgradeDate = new Date().toISOString();
                
                if (window.userProfileManager.saveUserProfile) {
                    await window.userProfileManager.saveUserProfile(profile);
                    log('upgradeStatus', 'User upgraded to PRO tier', 'success');
                    
                    // Refresh profile
                    if (window.userProfileManager.loadUserProfile) {
                        await window.userProfileManager.loadUserProfile();
                        log('upgradeStatus', 'Profile refreshed', 'success');
                    }
                } else {
                    log('upgradeStatus', 'saveUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('upgradeStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function testUpgradeToDev() {
            try {
                log('upgradeStatus', 'Testing upgrade to DEV...');
                
                const profile = window.userProfileManager?.userProfile;
                if (!profile) {
                    log('upgradeStatus', 'User not signed in!', 'error');
                    return;
                }

                profile.tier = 'DEV';
                profile.upgradeDate = new Date().toISOString();
                
                if (window.userProfileManager.saveUserProfile) {
                    await window.userProfileManager.saveUserProfile(profile);
                    log('upgradeStatus', 'User upgraded to DEV tier', 'success');
                    
                    // Refresh profile
                    if (window.userProfileManager.loadUserProfile) {
                        await window.userProfileManager.loadUserProfile();
                        log('upgradeStatus', 'Profile refreshed', 'success');
                    }
                } else {
                    log('upgradeStatus', 'saveUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('upgradeStatus', `Error: ${error.message}`, 'error');
            }
        }

        // System Status Functions
        function checkFirebaseConnection() {
            try {
                log('systemStatus', 'Checking Firebase connection...');
                
                if (window.db) {
                    log('systemStatus', 'Firebase database connection: OK', 'success');
                } else {
                    log('systemStatus', 'Firebase database connection: FAILED', 'error');
                }
                
                if (window.auth) {
                    log('systemStatus', 'Firebase auth connection: OK', 'success');
                } else {
                    log('systemStatus', 'Firebase auth connection: FAILED', 'error');
                }
            } catch (error) {
                log('systemStatus', `Error: ${error.message}`, 'error');
            }
        }

        function checkTierManager() {
            try {
                log('systemStatus', 'Checking TierManager...');
                
                const tierManager = window.userProfileManager?.tierManager;
                if (tierManager) {
                    log('systemStatus', 'TierManager: OK', 'success');
                    log('systemStatus', `Available tiers: ${Object.keys(tierManager.tiers).join(', ')}`, 'info');
                } else {
                    log('systemStatus', 'TierManager: NOT FOUND', 'error');
                }
            } catch (error) {
                log('systemStatus', `Error: ${error.message}`, 'error');
            }
        }

        function checkUserProfileManager() {
            try {
                log('systemStatus', 'Checking UserProfileManager...');
                
                if (window.userProfileManager) {
                    log('systemStatus', 'UserProfileManager: OK', 'success');
                    
                    const profile = window.userProfileManager.userProfile;
                    if (profile) {
                        log('systemStatus', `Current user: ${profile.email}`, 'info');
                    } else {
                        log('systemStatus', 'No user currently signed in', 'warning');
                    }
                } else {
                    log('systemStatus', 'UserProfileManager: NOT FOUND', 'error');
                }
            } catch (error) {
                log('systemStatus', `Error: ${error.message}`, 'error');
            }
        }

        // Reset Functions
        async function resetToFree() {
            try {
                log('resetStatus', 'Resetting user to FREE tier...');
                
                const profile = window.userProfileManager?.userProfile;
                if (!profile) {
                    log('resetStatus', 'User not signed in!', 'error');
                    return;
                }

                profile.tier = 'FREE';
                profile.submissionCount = { daily: 0, weekly: 0, monthly: 0 };
                delete profile.upgradeDate;
                
                if (window.userProfileManager.saveUserProfile) {
                    await window.userProfileManager.saveUserProfile(profile);
                    log('resetStatus', 'User reset to FREE tier with 0 submissions', 'success');
                    
                    // Refresh profile
                    if (window.userProfileManager.loadUserProfile) {
                        await window.userProfileManager.loadUserProfile();
                        log('resetStatus', 'Profile refreshed', 'success');
                    }
                } else {
                    log('resetStatus', 'saveUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('resetStatus', `Error: ${error.message}`, 'error');
            }
        }

        function clearAllData() {
            try {
                log('resetStatus', 'Clearing all local data...');
                localStorage.clear();
                sessionStorage.clear();
                log('resetStatus', 'All local data cleared', 'success');
                log('resetStatus', 'Please refresh the page to reload', 'warning');
            } catch (error) {
                log('resetStatus', `Error: ${error.message}`, 'error');
            }
        }

        async function refreshProfile() {
            try {
                log('resetStatus', 'Force refreshing profile...');
                
                if (window.userProfileManager?.loadUserProfile) {
                    await window.userProfileManager.loadUserProfile();
                    log('resetStatus', 'Profile force refreshed', 'success');
                } else {
                    log('resetStatus', 'loadUserProfile function not found!', 'error');
                }
            } catch (error) {
                log('resetStatus', `Error: ${error.message}`, 'error');
            }
        }

        // Auto-check system on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkFirebaseConnection();
                checkTierManager();
                checkUserProfileManager();
            }, 2000);
        });
    </script>
</body>
</html> 